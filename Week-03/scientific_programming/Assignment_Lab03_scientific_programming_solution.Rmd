---
title: "Assignment 3"
author: "Dirk Pflugmacher"
date: "02.11.2016"
output: html_document
---

### Tutor: Wilhelm Furian
wilhelm.furian@student.hu-berlin.de

### Steps:

1. Complete the tasks. Write your R code in the designated areas.
2. Create an HTML file in R-Studio: | Menu | File | Knit Document 
3. RENAME the file: lastname_assignment3.html
4. Upload your assignment to Moodle

### 1. Write a function that calculates the 95% confidence interval

```{r}
ci <- function(x){
  se <- sd(x, na.rm = TRUE) / sqrt(sum(is.na(x)==FALSE))
  return(1.96 * se)
}
```

### 2. Mean and standard deviation

Use the `apply()` function to calculate the sample mean and standard deviation of 'Ozone', 'Solar', 'Temp', and 'Wind':

```{r}
apply(X = airquality[, 1:4], MARGIN = 2, FUN = mean, na.rm = TRUE)
apply(X = airquality[, 1:4], MARGIN = 2, FUN = sd, na.rm = TRUE)
```

### 3. Daily climate observations

Download the file 'daily_observation_potsdam_1893_2012.txt' from Moodle. Find out how the data is formated and structured by opening the file in a text editor. Then, import the file into R. Note, you do not have to edit the text file in order to import it. How many observations does the dataset contain?

```{r}
dat <- read.table("Data/daily_observation_potsdam_1893_2012.txt", sep = ";", dec = ",", header=TRUE, skip=7)
nrow(dat)
```

### 4. Date

From the column 'Mess_Datum' (measurement date), create three new columns: 'Year', 'Month', and 'Day'. Hint: Use the `substring()` function!

```{r}
dat$Year <- substring(dat$Mess_Datum, first = 1, last = 4)
dat$Month <- substring(dat$Mess_Datum, first = 5, last = 6)
dat$Day <- substring(dat$Mess_Datum, first = 7, last = 8)
```

### 5. Date range

What is the earliest and latest year at which measurements were taken? Write an expression to extract that information.

```{r}
range(as.numeric(dat$Year))
```

### 6. Yearly and monthly mean

From the variable 'LUFTTEMPERATUR' (air temperature), calculate the annual mean and the monthly mean air temperature (Jan to Dec). Assign the results to a vector.

```{r}
annual_mean <- as.vector(tapply(dat$LUFTTEMPERATUR, INDEX = dat$Year, FUN = mean))

monthly_mean <- as.vector(tapply(dat$LUFTTEMPERATUR, INDEX = dat$Month, FUN = mean))
```

Create a scatterplot of annual mean temperature (y-axis) versus measurement year (x-axis):

```{r}
library(ggplot2)

plotdat <- data.frame(Year = 1893:2012,
                      Temperature = annual_mean)

ggplot(data = plotdat, aes(x = Year, y = Temperature)) +
  geom_point()
```

### 7. Write a function f_power()

Write a function f_power(x) that takes a vector (x_1, x_2, ..., x_n) as input and returns a vector ((x_1)^1, (x_2)^2, ..., (x_n)^n). Try out your function with x=c(1:5,10:6).

```{r}
f_power <- function(x){
  
  y = rep(NA, length(x))
  for (i in 1:length(x)) {
    y[i] <- x[i]^i
  }
  return(y)
}

c(1:5,10:6)
f_power(c(1:5,10:6))
```


### 8. Write a function f_moving_average()

Write a function f_moving_average() that takes a vector (x_1, x_2, ..., x_n) as input and returns a vector of moving averages ( (x_1 + x_2 + x_3)/3, ...,  (x_n-2 + x_n-1 + x_n)/3). Try out your function with f_moving_average( c(1:5,6:1)).

```{r}

f_moving_average3_v1 <- function(x) {
  result <- c()
  for (i in 2:(length(x)-1)) {
    result <- c(result, mean(x[(i-1):(i+1)]))
  }
  return(result)
}

f_moving_average3_v2 <- function(x) {
  result <- rep(NA, length(x))
  for (i in 2:(length(x)-1)) {
    result[i] <- mean(x[(i-1):(i+1)])
  }
  return(result)
}

f_moving_average <- function(x, w=3) {
  s = (w-1)/2
  result <- rep(NA, length(x))
  for (i in (1+s):(length(x)-s)) {
    result[i] <- mean(x[(i-s):(i+s)])
  }
  return(result)
}

c(1:5,10:6)
f_moving_average(c(1:5,10:6), w=3)
filter(c(1:5,10:6), rep(1,3)/3)
```

### 9. Smoothing

Smooth the time series of annual mean temperature (you created) using a moving average filter of length 11. Create a plot of the original time series together with the smoothed time series.

```{r}
  
plotdat$Temperature_smooth <- f_moving_average(plotdat$Temperature, w = 11)

ggplot(data = plotdat, aes(x = Year, y = Temperature)) +
  geom_point() +
  geom_line(aes(x = Year, y = Temperature_smooth), col = "red")
```